<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2014-12-25 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Lens - </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20141225" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://inmobi.github.io/grill" id="bannerLeft">
                                        <img src="http://inmobi.github.io/grill/grill-logo.png" alt="Lens Analytics Platform for InMobi" title="Lens Analytics Platform" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
                                  <a href="../.." title="InMobi">InMobi</a>
        &gt;
                          <a href=".././" title="Lens">Lens</a>
        &gt;
    
      </div>
            <div class="xright">        
                    
                 <span id="publishDate">Last Published: 2014-12-25</span>
              &nbsp;| <span id="projectVersion">Version: 1.2.1</span>
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Lens</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../gettingstarted/quick-start.html" title="Getting Started">Getting Started</a>
            </li>
                  <li class="none">
                          <a href="../gettingstarted/install-steps.html" title="Install and Run">Install and Run</a>
            </li>
                  <li class="none">
                          <a href="../gettingstarted/pseudo-distributed-setup.html" title="Pseudo Distributed Setup">Pseudo Distributed Setup</a>
            </li>
          </ul>
                       <h5>User Documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="../user/index.html" title="Lens User Guide">Lens User Guide</a>
            </li>
                  <li class="none">
                          <a href="../user/olap-cube.html" title="OLAP data cube">OLAP data cube</a>
            </li>
                  <li class="none">
                          <a href="../rest.html" title="REST API">REST API</a>
            </li>
                  <li class="none">
                          <a href="../user/cli.html" title="Lens CLI">Lens CLI</a>
            </li>
                  <li class="none">
                          <a href="../user/java-client.html" title="Java Client Library">Java Client Library</a>
            </li>
                  <li class="none">
                          <a href="../user/jdbc-client.html" title="JDBC Client">JDBC Client</a>
            </li>
                  <li class="none">
                          <a href="../user/faq.html" title="FAQ">FAQ</a>
            </li>
          </ul>
                       <h5>Developer Documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="../developer/contribute.html" title="Contributor Guide">Contributor Guide</a>
            </li>
                  <li class="none">
                          <a href="../developer/commit.html" title="Committer Guide">Committer Guide</a>
            </li>
                  <li class="none">
                          <a href="../developer/design.html" title="Lens Design">Lens Design</a>
            </li>
                  <li class="none">
                          <a href="../developer/driver.html" title="Driver Developer Guide">Driver Developer Guide</a>
            </li>
          </ul>
                       <h5>Admin Documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="../admin/index.html" title="Admin Overview">Admin Overview</a>
            </li>
                  <li class="none">
                          <a href="../admin/deployment.html" title="Deployment">Deployment</a>
            </li>
                  <li class="none">
                          <a href="../admin/config-server.html" title="Configuration">Configuration</a>
            </li>
                  <li class="none">
                          <a href="../admin/cli.html" title="Admin CLI">Admin CLI</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                        <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                                                                                                                                     <a href="http://www.inmobi.com/" title="inmobi" class="poweredBy">
        <img class="poweredBy"  alt="inmobi" src="../../images/inmobi-logo.jpg"     />
      </a>
                       
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!--  --><!-- Licensed to the Apache Software Foundation (ASF) under one --><!-- or more contributor license agreements.  See the NOTICE file --><!-- distributed with this work for additional information --><!-- regarding copyright ownership.  The ASF licenses this file --><!-- to you under the Apache License, Version 2.0 (the --><!-- "License"); you may not use this file except in compliance --><!-- with the License.  You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, --><!-- software distributed under the License is distributed on an --><!-- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY --><!-- KIND, either express or implied.  See the License for the --><!-- specific language governing permissions and limitations --><!-- under the License. --><!--  --><div class="section">
<h2>Query results<a name="Query_results"></a></h2>
<p>This document contains details on query result - fetching, formatting and etc.</p>
<p>Lens query service allows users to fetch results of query by specifying the handle-id. It provides rest api to fetch result-metadata and the results.</p>
<p>Here are various options provided for result formatting and fetching:</p>
<div class="section">
<h3>Persisting results by server<a name="Persisting_results_by_server"></a></h3>
<p>Server can persists the results in configured location, also format the results of the query, with a custom format.</p>
<p>User can provide a custom output formatter which implements <a href="../apidocs/org/apache/lens/server/api/query/InMemoryOutputFormatter.html">InMemoryOutputFormatter</a> or <a href="../apidocs/org/apache/lens/server/api/query/PersistedOutputFormatter.html">PersistedOutputFormatter</a></p>
<p>Default implementation of formatting offers writing it into a file, but a new implementation can be provided which persist in a db or whatever.</p>
<p>The file based formatting provides following options:</p>
<ul>
<li>Optionally write header</li>
<li>Format the rows of the results like csv, or separate them with ctrl character characters, which can be described through a Hive SerDe.</li>
<li>Optionally write the output with a charset encoding.</li>
<li>Optionally write footer</li>
<li>Provide an extension to the file name</li>
<li>Optionally compress the file</li>
<li>Skip formatting if result size exceeds a configured threshold</li>
<li>Optionally allow result to be split into multiple files, with configured number of rows in ech file.</li></ul></div>
<div class="section">
<h3>Persisting results by driver<a name="Persisting_results_by_driver"></a></h3>
<p>The driver can persist the query output in a location. When driver persists the results, the rows of the result can be formatted by the driver.</p>
<p>HiveDriver allows users to specify the format of the result through a configuration. It will persist the result in queryhandle-id directory inside hdfsout directory in the parent result directory. </p>
<p>Since persisting the results by driver only allows formatting of the rows, if user requires further formatting, the results should be persisted by server again.</p></div>
<div class="section">
<h3>Formatting summary<a name="Formatting_summary"></a></h3>
<p>Below table depicts all the formatting options provided by query service</p>
<table border="1" class="bodyTable">
<tr class="a">
<td align="left">Formatting of the results</td>
<td align="left"><b>Not persisted by driver</b></td>
<td align="left"><b>Persisted by driver</b></td></tr>
<tr class="b">
<td align="left"><b>Not persisted by server</b></td>
<td align="left">No formatting</td>
<td align="left">Row level formatting</td></tr>
<tr class="a">
<td align="left"><b>Persisted by server</b></td>
<td align="left">All query output formatting</td>
<td align="left">All query output formatting on top of row level formatting done by driver</td></tr></table>
<p>See <a href="../admin/config.html"> here</a> for all the configuration property names</p></div>
<div class="section">
<h3>Fetching the results<a name="Fetching_the_results"></a></h3>
<p>If the results are persisted either by server or driver, the user would get the result set as PersistentQueryResult. If results are not persisted, then user would get the result as InMemoryQueryResult.</p>
<table border="1" class="bodyTable">
<tr class="a">
<td align="left">ResultSet</td>
<td align="left"><b>Not persisted by driver</b></td>
<td align="left"><b>Persisted by driver</b></td></tr>
<tr class="b">
<td align="left"><b>Not persisted by server</b></td>
<td align="left">InMemoryQueryResult</td>
<td align="left">PersistentQueryResult</td></tr>
<tr class="a">
<td align="left"><b>Persisted by server</b></td>
<td align="left">PersistentQueryResult</td>
<td align="left">PersistentQueryResult</td></tr></table>
<p>If results are persisted by server, user can get the result as a http end point, which he can download or see it in the browser. The http result set can be obtained by the rest endpoint <a href="../resource_QueryServiceResource.html#path__queryapi_queries_-queryHandle-_httpresultset.html">/queryapi/queries/queryhandle/httpresultresult</a></p>
<p>The results can be fetched as PersistentQueryResult or InMemoryQueryResult from the end point <a href="../resource_QueryServiceResource.html#path__queryapi_queries_-queryHandle-_resultset.html">/queryapi/queries/queryhandle/resultresult</a></p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2014
                        <a href="http://www.apache.org">Apache Software Foundation</a>.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
