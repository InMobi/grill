<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-02-27
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150227" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Lens &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href=".././" id="bannerLeft">
                                                                                                <img src="../images/apache-lens-logo.png"  alt="Lens Analytics Platform" height="54px"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://incubator.apache.org" id="bannerRight">
                                                                                                <img src="../images/apache-incubator-logo.png"  alt="Apache Incubator"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://www.apache.org" class="externalLink" title="Apache">
        Apache</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href=".././" title="Lens">
        Lens</a>
        </li>
      <li class="divider ">/</li>
        <li class=""></li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2015-02-27</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 2.1.0-inm-SNAPSHOT</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Lens</li>
                                
      <li>
    
                          <a href="../index.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                  
      <li>
    
                          <a href="../lenshome/quick-start.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                  
      <li>
    
                          <a href="../lenshome/install-and-run.html" title="Installing and Running Lens">
          <i class="none"></i>
        Installing and Running Lens</a>
            </li>
                  
      <li>
    
                          <a href="../lenshome/pseudo-distributed-setup.html" title="Pseudo Distributed Setup">
          <i class="none"></i>
        Pseudo Distributed Setup</a>
            </li>
                              <li class="nav-header">Releases</li>
                                
      <li>
    
                          <a href="../releases/download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                  
      <li>
    
                          <a href="../releases/compatibility.html" title="Compatibility">
          <i class="none"></i>
        Compatibility</a>
            </li>
                  
      <li>
    
                          <a href="../releases/release-history.html" title="All Releases">
          <i class="none"></i>
        All Releases</a>
            </li>
                              <li class="nav-header">User Documentation</li>
                                
      <li>
    
                          <a href="../user/index.html" title="Lens User Guide">
          <i class="none"></i>
        Lens User Guide</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>OLAP data cube</a>
          </li>
                  
      <li>
    
                          <a href="../rest.html" title="REST API">
          <i class="none"></i>
        REST API</a>
            </li>
                  
      <li>
    
                          <a href="../user/cli.html" title="Lens CLI">
          <i class="none"></i>
        Lens CLI</a>
            </li>
                  
      <li>
    
                          <a href="../user/java-client.html" title="Java Client Library">
          <i class="none"></i>
        Java Client Library</a>
            </li>
                  
      <li>
    
                          <a href="../user/jdbc-client.html" title="JDBC Client">
          <i class="none"></i>
        JDBC Client</a>
            </li>
                  
      <li>
    
                          <a href="../user/ml.html" title="Lens ML">
          <i class="none"></i>
        Lens ML</a>
            </li>
                  
      <li>
    
                          <a href="../user/faq.html" title="FAQ">
          <i class="none"></i>
        FAQ</a>
            </li>
                              <li class="nav-header">Developer Documentation</li>
                                
      <li>
    
                          <a href="../developer/contribute.html" title="Contributor Guide">
          <i class="none"></i>
        Contributor Guide</a>
            </li>
                  
      <li>
    
                          <a href="../developer/commit.html" title="Committer Guide">
          <i class="none"></i>
        Committer Guide</a>
            </li>
                  
      <li>
    
                          <a href="../developer/design.html" title="Lens Design">
          <i class="none"></i>
        Lens Design</a>
            </li>
                  
      <li>
    
                          <a href="../developer/driver.html" title="Driver Developer Guide">
          <i class="none"></i>
        Driver Developer Guide</a>
            </li>
                              <li class="nav-header">Admin Documentation</li>
                                
      <li>
    
                          <a href="../admin/index.html" title="Admin Overview">
          <i class="none"></i>
        Admin Overview</a>
            </li>
                  
      <li>
    
                          <a href="../admin/deployment.html" title="Deployment">
          <i class="none"></i>
        Deployment</a>
            </li>
                  
      <li>
    
                          <a href="../admin/config-server.html" title="Configuration">
          <i class="none"></i>
        Configuration</a>
            </li>
                  
      <li>
    
                          <a href="../admin/cli.html" title="Admin CLI">
          <i class="none"></i>
        Admin CLI</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                      
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                    
      <li>
    
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                         <a href="http://www.apache.org/" title="ASF" class="builtBy">
        <img class="builtBy"  alt="ASF" src="../images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!--  --><!-- Licensed to the Apache Software Foundation (ASF) under one --><!-- or more contributor license agreements.  See the NOTICE file --><!-- distributed with this work for additional information --><!-- regarding copyright ownership.  The ASF licenses this file --><!-- to you under the Apache License, Version 2.0 (the --><!-- "License"); you may not use this file except in compliance --><!-- with the License.  You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, --><!-- software distributed under the License is distributed on an --><!-- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY --><!-- KIND, either express or implied.  See the License for the --><!-- specific language governing permissions and limitations --><!-- under the License. --><!--  --><div class="section">
<h2><a name="OLAP_Data_cube_concepts"></a>OLAP Data cube concepts</h2>
<ul>
<li><a href="#OLAP_Data_cube_concepts">OLAP Data cube concepts</a>
<ul>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Metastore_model">Metastore model</a>
<ul>
<li><a href="#Storage">Storage</a></li>
<li><a href="#Cube">Cube</a>
<ul>
<li><a href="#Measure">Measure</a></li>
<li><a href="#Dimension">Dimension</a></li></ul></li>
<li><a href="#Derived_Cube">Derived Cube</a></li>
<li><a href="#Fact_Tables">Fact Tables</a></li>
<li><a href="#Dimension_tables">Dimension tables</a></li>
<li><a href="#Update_Period">Update Period</a></li>
<li><a href="#Storage_tables">Storage tables</a>
<ul>
<li><a href="#Fact_storage_table">Fact storage table</a></li>
<li><a href="#Dimension_storage_table">Dimension storage table</a></li>
<li><a href="#Naming_convention">Naming convention</a></li>
<li><a href="#Partition">Partition</a></li></ul></li></ul></li>
<li><a href="#Metastore_API">Metastore API</a></li>
<li><a href="#Query_Language">Query Language</a></li></ul></li>
<li><a href="#How_to_pass_timerange_in_cubeQL">How to pass timerange in cubeQL</a></li>
<li><a href="#Example_queries_with_relative_timerange:">Example queries with relative timerange:</a></li>
<li><a href="#Example_queries_with_absolute_timerange:">Example queries with absolute timerange:</a>
<ul>
<li><a href="#Query_API">Query API</a></li></ul></li></ul>
<div class="section">
<h3><a name="Introduction"></a>Introduction</h3>
<p>Typical data layout in a data ware house is to have fact data rolled up with time and reduce dimensions at each level. Fact data will have dimension keys sothat it can be joined with actual dimension tables to get more information on dimension attributes.</p>
<p>The typical data layout is depicted in the following diagram.</p><img src="/images/data-layout.png" alt="Fact data and dimension data" />
<p>Lens provides an abstraction to represent above layout, and allows user to define schema of the data at conceptual level and also query the same, without knowing the physical storages and rollups, which is described in below sections.</p></div>
<div class="section">
<h3><a name="Metastore_model"></a>Metastore model</h3>
<p>Metastore model introduces constructs Storage, Cube, Fact table and Dimension table, Partition.</p>
<div class="section">
<h4><a name="Storage"></a>Storage</h4>
<p>Storage represents a physical storage. It can be Hadoop File system or a data base. It is defined by name, endpoint and properties associated with.</p></div>
<div class="section">
<h4><a name="Cube"></a>Cube</h4>
<p>A cube is a set of dimensions and measures in a particular subject, which users can query. Cubes also have timed dimensions, which can be used query cube for a time range.</p>
<div class="section">
<h5><a name="Measure"></a>Measure</h5>
<p>A measure is a quantity that you are interested in measuring.</p>
<p>Measure will have name, type, default aggregator, a format string, start time and end time. Measure can be simple column measure or an expression measure which is associated with an expression.</p></div>
<div class="section">
<h5><a name="Dimension"></a>Dimension</h5>
<p>A dimension is an attribute, or set of attributes, by which you can divide measures into sub-categories.</p>
<ul>
<li>A dimension can be as simple as having name and type. // BaseDimension</li>
<li>A dimension can also refer to a dimension table // ReferencedDimension</li>
<li>A dimension can be associated with an expression // ExpressionDimension</li>
<li>A dimension can be a hierarchy of dimensions. // HierachicalDimension</li>
<li>A dimension can define all the possible values it can take. // InlineDimension</li></ul></div></div>
<div class="section">
<h4><a name="Derived_Cube"></a>Derived Cube</h4>
<p>A derived cube will have subset of measures and dimensions of a base cube. User can query derived cube as well, very similar to cube. For a derived cube, user would specify set of measure names and dimension names only, the definition of measure/dimension will be derived from base cube. All the measures and dimensions of derived cube can always be queried together, whereas all measures and dimensions of parent cube may not be allowed to query together.</p></div>
<div class="section">
<h4><a name="Fact_Tables"></a>Fact Tables</h4>
<p>A fact table is table having columns. Columns are subset of measures and dimensions. The fact table is associated with cube, specified by name. Fact can be available in multiple storages. The fact will be used to answer the queries on derived cubes as well.</p></div>
<div class="section">
<h4><a name="Dimension_tables"></a>Dimension tables</h4>
<p>A table with list of columns. It can have references to other dimension tables. Theses tables can be joined with cubes while querying. These tables can be available in multiple storages. </p></div>
<div class="section">
<h4><a name="Update_Period"></a>Update Period</h4>
<p>Fact or dimension tables can be updated at regular intervals. Supports SECONDLY, MINUTELY, HOURLY, DAILY, WEEKLY, MONTHLY, QUARTERLY, YEARLY update periods.</p></div>
<div class="section">
<h4><a name="Storage_tables"></a>Storage tables</h4>
<p>The physical tables, either fact or dimension tables, present on a storage. It will have the same schema as fact/dimension table definition. Each physical table can have its own storage descriptor. These tables can be partitioned by columns. Usually partition columns are dimensions. They can be timed dimensions or other dimensions.</p>
<div class="section">
<h5><a name="Fact_storage_table"></a>Fact storage table</h5>
<p>Fact storage table is the physical fact table for the associated storage, for the specified update period. The storage table can be associated with multiple update periods.</p></div>
<div class="section">
<h5><a name="Dimension_storage_table"></a>Dimension storage table</h5>
<p>Dimension storage table is the physical dimension table for the associated storage. Dimension storage table can have snapshot dumps at specified regular intervals or a table with no dumps, so the storage table can have zero or one update period.</p></div>
<div class="section">
<h5><a name="Naming_convention"></a>Naming convention</h5>
<p>The name of the storage table is storage name followed fact/dimensions table, seperated by '_&quot;.</p>
<p>Ex: For fact table name: FACT1, for storage:S1, the storage table name is S1_FACT1 For dimension table name: DIM1, for storage:S1, the storage table name is S1_DIM1</p></div>
<div class="section">
<h5><a name="Partition"></a>Partition</h5>
<p>Each partition on the storage table can have its own storage descriptor.</p></div></div></div>
<div class="section">
<h3><a name="Metastore_API"></a>Metastore API</h3>
<p>LENS provides <a href="../resource_MetastoreResource.html"> REST api</a>, <a href="../apidocs/org/apache/lens/client/LensMetadataClient.html"> Java client api</a> and <a href="./cli.html#OLAP_Data_cube_metadata_management"> CLI</a> for doing CRUD on metastore.</p></div>
<div class="section">
<h3><a name="Query_Language"></a>Query Language</h3>
<p>User can query the lens through OLAP Cube QL, which is subset of Hive QL.</p>
<p>Here is the grammar:</p>
<div class="source">
<pre>
  CUBE SELECT [DISTINCT] select_expr, select_expr, ...
  FROM cube_table_reference
  [WHERE [where_condition AND] [TIME_RANGE_IN(colName, from, to)]]
  [GROUP BY col_list]
  [HAVING having_expr]
  [ORDER BY colList]
  [LIMIT number]
  
  cube_table_reference:
  cube_table_factor
  | join_table
  join_table:
  cube_table_reference JOIN cube_table_factor [join_condition]
  | cube_table_reference {LEFT|RIGHT|FULL} [OUTER] JOIN cube_table_reference [join_condition]
  cube_table_factor:
  cube_name or dimension_name [alias]
  | ( cube_table_reference )
  join_condition:
  ON equality_expression ( AND equality_expression )*
  equality_expression:
  expression = expression
  colOrder: ( ASC | DESC )
  colList : colName colOrder? (',' colName colOrder?)*
  
  TIME_RANGE_IN(colName, from, to) : The time range inclusive of &#x2018;from&#x2019; and exclusive of &#x2018;to&#x2019;.
  time range clause is applicable only if cube_table_reference has cube_name.
  Format of the time range is &lt;yyyy-MM-dd-HH:mm:ss,SSS&gt;
</pre></div>
<p>OLAP Cube QL supports all the functions that hive supports as documented in Hive Functions</p>
<p>Query engine provides following features :</p>
<ul>
<li>Figure out which dimension tables contain data needed to satisfy the query.</li>
<li>Figure out the exact fact tables and their partitions based on the time range in the query. While doing this, it will try to minimize computation needed to complete the queries.</li>
<li>If No Join condition is passed for Joins,join condition will be inferred from the relationship definition.</li>
<li>Projected fields can be added to group by col list automatically, if not present and if the group by keys specified are not projected, they can be projected</li>
<li>Automatically add aggregate functions to measures specified as measure's default aggregate.
<p>Various configurations available for running an OLAP query are documented at <a href="./olap-query-conf.html"> OLAP query configurations</a> </p></li></ul></div></div>
<div class="section">
<h2><a name="How_to_pass_timerange_in_cubeQL"></a><b>How to pass timerange in cubeQL</b></h2>
<p>Users have the capability to specify the time range as absolute and relative time in lens cube query. Lens cube query language allows passing timerange at different granularities like secondly, minutely, hourly, daily, weekly, monthly and yearly. Relative timerange is helpful to the users in scheduling their queries</p>
<p>User can specify the HOURLY granularity with 'now.hour'.</p>
<p>The follwong table tells the available <b>unit granularities</b> and how to specify those granualarities for relative timerange</p>
<table border="1" class="table table-striped">
<tr class="a">
<th align="left">UNIT</th>
<th align="left">Specification</th>
<th align="left">Relative time</th></tr>
<tr class="b">
<td align="left">Secondly</td>
<td align="left">now.second</td>
<td align="left">now.second<a name="a-">+/-</a>30seconds</td></tr>
<tr class="a">
<td align="left">Minutely</td>
<td align="left">now.minute</td>
<td align="left">now.minute<a name="a-">+/-</a>30minutes</td></tr>
<tr class="b">
<td align="left">Hourly</td>
<td align="left">now.hour</td>
<td align="left">now.hour<a name="a-">+/-</a>3hours</td></tr>
<tr class="a">
<td align="left">Daily</td>
<td align="left">now.day</td>
<td align="left">now.day<a name="a-">+/-</a>3days</td></tr>
<tr class="b">
<td align="left">Weekly</td>
<td align="left">now.week</td>
<td align="left">now.week<a name="a-">+/-</a>3weeks</td></tr>
<tr class="a">
<td align="left">Monthly</td>
<td align="left">now.month</td>
<td align="left">now.month<a name="a-">+/-</a>3months</td></tr>
<tr class="b">
<td align="left">Yearly</td>
<td align="left">now.year</td>
<td align="left">now.year<a name="a-">+/-</a>2years</td></tr></table></div>
<div class="section">
<h2><a name="Example_queries_with_relative_timerange:"></a><b>Example queries with relative timerange</b>:</h2>
<div class="source">
<pre>
 query execute cube select col1 from cube where TIME_RANGE_IN(col2, &quot;now.hour-4hours&quot;, &quot;now.hour&quot;)

 The above queries for the last 4hours data.</pre></div>
<p>Users can query the data with absolute timerange at different granularities. The following table describes how to specify absoulte timerange at different granularities</p>
<table border="1" class="table table-striped">
<tr class="a">
<th align="left">UNIT</th>
<th align="left">Absolute time specification</th></tr>
<tr class="b">
<td align="left">Secondly</td>
<td align="left">yyyy-MM-dd-HH:mm:ss</td></tr>
<tr class="a">
<td align="left">Minutely</td>
<td align="left">yyyy-MM-dd-HH:mm</td></tr>
<tr class="b">
<td align="left">Hourly</td>
<td align="left">yyyy-MM-dd-HH</td></tr>
<tr class="a">
<td align="left">Daily</td>
<td align="left">yyyy-MM-dd</td></tr>
<tr class="b">
<td align="left">Monthly</td>
<td align="left">yyyy-MM</td></tr>
<tr class="a">
<td align="left">Yearly</td>
<td align="left">yyyy</td></tr></table></div>
<div class="section">
<h2><a name="Example_queries_with_absolute_timerange:"></a><b>Example queries with absolute timerange</b>:</h2>
<div class="source">
<pre>
 query execute cube select col1 from cube where TIME_RANGE_IN(it, &quot;2014-12-29-07&quot;, &quot;2014-12-29-11&quot;)

 query execute cube select col1 from cube where TIME_RANGE_IN(it, &quot;2014-12-29&quot;, &quot;2014-12-30&quot;)

 It queries the data between 29th Dec 2014 and 30th Dec 2014.
</pre></div>
<div class="section">
<h3><a name="Query_API"></a>Query API</h3>
<p>LENS provides <a href="../resource_QueryServiceResource.html"> REST api</a>, <a href="../apidocs/org/apache/lens/client/LensStatement.html"> Java client api</a>, <a href="./jdbc-client.html"> JDBC client</a> and <a href="./cli.html#Query_Management"> CLI</a> for doing submitting queries, checking status and fetching results.</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2014-2015
                        <a href="http://www.apache.org">Apache Software Foundation</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
