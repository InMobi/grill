<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-03-02
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150302" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Lens &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href=".././" id="bannerLeft">
                                                                                                <img src="../images/apache-lens-logo.png"  alt="Lens Analytics Platform" height="54px"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://incubator.apache.org" id="bannerRight">
                                                                                                <img src="../images/apache-incubator-logo.png"  alt="Apache Incubator"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://www.apache.org" class="externalLink" title="Apache">
        Apache</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href=".././" title="Lens">
        Lens</a>
        </li>
      <li class="divider ">/</li>
        <li class=""></li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2015-03-02</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 2.1.0-inm</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Lens</li>
                                
      <li>
    
                          <a href="../index.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                  
      <li>
    
                          <a href="../lenshome/quick-start.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                  
      <li>
    
                          <a href="../lenshome/install-and-run.html" title="Installing and Running Lens">
          <i class="none"></i>
        Installing and Running Lens</a>
            </li>
                  
      <li>
    
                          <a href="../lenshome/pseudo-distributed-setup.html" title="Pseudo Distributed Setup">
          <i class="none"></i>
        Pseudo Distributed Setup</a>
            </li>
                              <li class="nav-header">Releases</li>
                                
      <li>
    
                          <a href="../releases/download.html" title="Download">
          <i class="none"></i>
        Download</a>
            </li>
                  
      <li>
    
                          <a href="../releases/compatibility.html" title="Compatibility">
          <i class="none"></i>
        Compatibility</a>
            </li>
                  
      <li>
    
                          <a href="../releases/release-history.html" title="All Releases">
          <i class="none"></i>
        All Releases</a>
            </li>
                              <li class="nav-header">User Documentation</li>
                                
      <li class="active">
    
            <a href="#"><i class="none"></i>Lens User Guide</a>
          </li>
                  
      <li>
    
                          <a href="../user/olap-cube.html" title="OLAP data cube">
          <i class="none"></i>
        OLAP data cube</a>
            </li>
                  
      <li>
    
                          <a href="../rest.html" title="REST API">
          <i class="none"></i>
        REST API</a>
            </li>
                  
      <li>
    
                          <a href="../user/cli.html" title="Lens CLI">
          <i class="none"></i>
        Lens CLI</a>
            </li>
                  
      <li>
    
                          <a href="../user/java-client.html" title="Java Client Library">
          <i class="none"></i>
        Java Client Library</a>
            </li>
                  
      <li>
    
                          <a href="../user/jdbc-client.html" title="JDBC Client">
          <i class="none"></i>
        JDBC Client</a>
            </li>
                  
      <li>
    
                          <a href="../user/ml.html" title="Lens ML">
          <i class="none"></i>
        Lens ML</a>
            </li>
                  
      <li>
    
                          <a href="../user/faq.html" title="FAQ">
          <i class="none"></i>
        FAQ</a>
            </li>
                              <li class="nav-header">Developer Documentation</li>
                                
      <li>
    
                          <a href="../developer/contribute.html" title="Contributor Guide">
          <i class="none"></i>
        Contributor Guide</a>
            </li>
                  
      <li>
    
                          <a href="../developer/commit.html" title="Committer Guide">
          <i class="none"></i>
        Committer Guide</a>
            </li>
                  
      <li>
    
                          <a href="../developer/design.html" title="Lens Design">
          <i class="none"></i>
        Lens Design</a>
            </li>
                  
      <li>
    
                          <a href="../developer/driver.html" title="Driver Developer Guide">
          <i class="none"></i>
        Driver Developer Guide</a>
            </li>
                              <li class="nav-header">Admin Documentation</li>
                                
      <li>
    
                          <a href="../admin/index.html" title="Admin Overview">
          <i class="none"></i>
        Admin Overview</a>
            </li>
                  
      <li>
    
                          <a href="../admin/deployment.html" title="Deployment">
          <i class="none"></i>
        Deployment</a>
            </li>
                  
      <li>
    
                          <a href="../admin/config-server.html" title="Configuration">
          <i class="none"></i>
        Configuration</a>
            </li>
                  
      <li>
    
                          <a href="../admin/cli.html" title="Admin CLI">
          <i class="none"></i>
        Admin CLI</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                      
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                    
      <li>
    
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                         <a href="http://www.apache.org/" title="ASF" class="builtBy">
        <img class="builtBy"  alt="ASF" src="../images/logos/maven-feather.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!--  --><!-- Licensed to the Apache Software Foundation (ASF) under one --><!-- or more contributor license agreements.  See the NOTICE file --><!-- distributed with this work for additional information --><!-- regarding copyright ownership.  The ASF licenses this file --><!-- to you under the Apache License, Version 2.0 (the --><!-- "License"); you may not use this file except in compliance --><!-- with the License.  You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, --><!-- software distributed under the License is distributed on an --><!-- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY --><!-- KIND, either express or implied.  See the License for the --><!-- specific language governing permissions and limitations --><!-- under the License. --><!--  --><div class="section">
<h2><a name="Lens_User_Guide"></a>Lens User Guide</h2>
<ul>
<li><a href="#Lens_User_Guide">Lens User Guide</a>
<ul>
<li><a href="#Overview">Overview</a></li>
<li><a href="#Configuration">Configuration</a></li>
<li><a href="#Session_Service">Session Service</a></li>
<li><a href="#Query_Execution_Service">Query Execution Service</a>
<ul>
<li><a href="#Query_Submission_Workflow">Query Submission Workflow</a></li>
<li><a href="#Getting_query_results">Getting query results</a></li>
<li><a href="#Life_of_a_Query_in_the_Lens_Server">Life of a Query in the Lens Server</a></li>
<li><a href="#Prepared_queries">Prepared queries</a></li></ul></li>
<li><a href="#Metastore_service">Metastore service</a></li></ul></li></ul>
<div class="section">
<h3><a name="Overview"></a>Overview</h3>
<p>Lens Server runs several services which can be used from their REST endpoints. This document covers some of the important services, their purpose and key API calls.</p>
<p>Lens server provides metastore service for managing metadata. Metadata exposed by lens is inspired by OLAP data cubes. See <a href="./olap-cube.html#Metastore_model"> Metastore Model</a> for metastore constructs that lens provides.</p>
<p>Lens server also provides query service for querying data exposed by lens. See <a href="./olap-cube.html#Query_Language"> Query Language</a> for the grammar of the query.</p>
<p>To access any service on lens, user should be working in a session. User can also pass various configuration parameters from client.</p>
<p>The sections below give more details on each service and configuration. </p></div>
<div class="section">
<h3><a name="Configuration"></a>Configuration</h3>
<p>Client configuration can be overridden in lens-client-site.xml. See <a href="./client-config.html">client configuration</a> for all the configuration parameters available and their default values.</p></div>
<div class="section">
<h3><a name="Session_Service"></a>Session Service</h3>
<p>To use any Lens service the user must first create a session. Each Lens session is associated with a unique session handle, which must be passed when making queries, or doing metadata operations in the same session. To check if the session service is deployed in the Lens Server, user can send a GET request to /session. An OK response means that the session service is deployed. </p>
<p>Sessions also allow users to set configuration or resources which could be shared across a group of queries. For example, if a group of queries need to call a UDF available in some specific jar, then the jar file can be added as a resource in the session. All queries started within the same session can make use of the jar file.</p>
<p>LENS provides <a href="../resource_SessionResource.html"> REST api</a>, <a href="../apidocs/org/apache/lens/client/LensConnection.html"> Java client api</a> and <a href="./cli.html#Session_management"> CLI</a> for doing all session level operations.</p>
<p>The important API calls exposed by the session resource are -</p>
<ul>
<li><a href="../resource_SessionResource.html#path__session.html">/session</a> - Endpoint to create or delete a session. </li>
<li><a href="../resource_SessionResource.html#path__session_params.html">/session/params</a> - Endpoint to maintain session settings</li>
<li><a href="../resource_SessionResource.html#path__session_resources_add.html">/session/resources</a> - Adding or removing resources from the session</li></ul></div>
<div class="section">
<h3><a name="Query_Execution_Service"></a>Query Execution Service</h3>
<p>The <a href="../resource_QueryServiceResource.html">Query Execution Service</a> is used to query data exposed by Lens. </p>
<div class="section">
<h4><a name="Query_Submission_Workflow"></a>Query Submission Workflow</h4>
<ul>
<li>Create a session using the session service</li>
<li>Submit a query by sending a POST to the <tt>/queryapi/queries</tt> endpoint. By default this call should return immediately with the query handle of the newly created query. Each query in Lens is associated with a unique query handle. Query handle can be used to check query status and get results. If users wish to submit an interactive query which finishes fast, the '<tt>op</tt>' parameter must be set to <tt>EXECUTE_WITH_TIMEOUT</tt>. This behaviour is explained in detail below.</li>
<li>In case of async execution, poll for query status by sending a GET to <tt>/queryapi/queries/queryhandle}</tt>. Once the query reaches <b>SUCCESSFUL</b> state, its results can be retrieved using the <tt>/queryapi/queries/<a name="queryhandle">queryhandle</a>/resultset</tt> endpoint.</li>
<li>By default the create query call returns immediately. This behaviour is intended to suit batch queries. However, for interactive queries it may be necessary to issue the query and get its result in a single call to the server. For such cases the create query call takes an 'op' argument. If the op parameter is set to <tt>EXECUTE_WITH_TIMEOUT</tt>, then an additional <tt>timeout</tt> value must also be passed. If the query completes before this timeout is reached, the call immediately returns with the query result set. If however, the query doesn't finish, only the query handle is returned, and users can further poll for query status and fetch results when the query is <b>SUCCESSFUL</b>.</li>
<li>At any time, user can cancel the execution of the query by sending a DELETE to <tt>/queryapi/queries/<a name="queryhandle">queryhandle</a></tt></li></ul>
<p>To summarize, given below are steps for batch (async) queries</p>
<ol style="list-style-type: decimal">
<li>Create session, note returned session handle.</li>
<li>Create query by passing session handle, note returned query handle.</li>
<li>Poll for query status by passing session handle and query handle.</li>
<li>If query is SUCCESSFUL, get results.</li></ol>
<p>Steps for interactive queries.</p>
<ol style="list-style-type: decimal">
<li>Create a session.</li>
<li>Create a query by setting <tt>op=EXECUTE_WITH_TIMEOUT</tt>, Also set the <tt>timeout</tt> value.</li>
<li>Check the response, if it contains only the query handle, then poll for status as is the case in async queries. If it contains both query handle and result set, then that means query did complete successfully within the timeout. </li></ol></div>
<div class="section">
<h4><a name="Getting_query_results"></a>Getting query results</h4>
<p>A query can be run once, but its results can be fetched any number of times, if the results are persisted, until its purged from server memory. Results can be obtained by sending a GET to <tt>/queryapi/queries/<a name="queryhandle">queryhandle</a>/resultset</tt>. This endpoint takes optional <tt>fromindex</tt> and <tt>fetchsize</tt> parameters which can be used for pagination of results.</p>
<p>Various query result formatting and fetching options are described in <a href="./query-results.html"> query result doc</a>.</p></div>
<div class="section">
<h4><a name="Life_of_a_Query_in_the_Lens_Server"></a>Life of a Query in the Lens Server</h4>
<p>The following diagram shows query state transition in the Lens Server </p><img src="/images/querystate.png" alt="Query States in Lens" />
<p>When user submits a query to the Lens Server, its starts in the <b>NEW</b> state. After the query is submitted, it moves into the <b>QUEUED</b> state. Until Lens server is free to take up the query, it remains in the <b>QUEUED</b> state. As soon as Lens server starts processing the query, it enters the <b>LAUNCHED</b> state. At this stage Lens has decided which backend engine will be used to execute the query. </p>
<p>For each query Lens server will poll the chosen backend engine for query status. A GET on the query endpoint returns the latest status of the query.</p>
<p>The <b>RUNNING</b> state indicates that the query is currently being processed by the query backend. After the <b>RUNNING</b> state, the query can enter either the <b>EXECUTED</b> or <b>FAILED</b> states, depending on the result of query execution. If the execution is successful, then server would format the result if required and then set the state to <b>SUCCESSFUL</b> or <b>FAILED</b> if formatting fails.</p>
<p>If the query is <b>SUCCESSFUL</b>, its result set can be retrieved using the result set API call, by passing the session handle and query handle. The query can be executed once, and its results can be fetched multiple times unless the query has been purged from Lens server state.</p>
<p>In any state, if the user requests that the query be cancelled, the query will enter into <b>CANCELLED</b> state. Query can be cancelled by sending a DELETE at the query endpoint. </p>
<p><b>FAILED</b>, <b>SUCCESSFUL</b> and <b>CANCELLED</b> are end states for a query. Once a query reaches these states, it becomes eligible to purging. The query is purged when its purge delay expires, after which it is not possible to retrieve results of the query. This purge delay is configurable. After purging the query enters the <b>CLOSED</b> state.</p></div>
<div class="section">
<h4><a name="Prepared_queries"></a>Prepared queries</h4>
<p>A query can be prepared for execution. Once prepared the query can be submitted for execution as many times as required. When prepared query is no longer required, it should be destroyed. REST api, JavaClient api and CLI commands are available for all the operations supported.</p>
<ul>
<li><a href="../resource_QueryServiceResource.html#path__queryapi_preparedqueries.html">Rest api for prepared queries</a></li>
<li><a href="../resource_QueryServiceResource.html#path__queryapi_preparedqueries_-prepareHandle-.html">Rest api for handling a prepared query</a></li>
<li><a href="../apidocs/org/apache/lens/client/LensStatement.html"> Java client api</a></li>
<li><a href="./cli.html#Query_Management"> CLI query management</a></li></ul></div></div>
<div class="section">
<h3><a name="Metastore_service"></a>Metastore service</h3>
<p>The Metastore service is used for DDL operations like creating, updating cubes, fact tables and dimensions. It also pprovides endpoints to create storage tables and to add partitions to a storage table. For more detailed information see the <a href="../resource_MetastoreResource.html">metastore service resource</a> documentation.</p>
<p>For resource exposed endpoint for cubes, facts, dimensions and storage tables. For each of the resource, HTTP methods specify the operation to be performed. For example, a POST on the cubes resource creates a cube, whereas a GET on the cubes reource will get list of all cubes. Similar convention is followed for fact, dimension, and storage tables.</p>
<p>For Java clients, JAXB classes corresponding to each of the endpoints are available.</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2014-2015
                        <a href="http://www.apache.org">Apache Software Foundation</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
